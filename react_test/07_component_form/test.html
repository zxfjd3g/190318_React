<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>07_component_form</title>
</head>
<body>
  <h2>非受控组件</h2>
<div id="root">
</div>

<br/>
<br/>
<h2>受控组件</h2>
<div id="root2"></div>

<script type="text/javascript" src="../js/react.development.js"></script>
<script type="text/javascript" src="../js/react-dom.development.js"></script>
<script type="text/javascript" src="../js/babel.min.js"></script>
<script type="text/babel">
  /*
  需求: 自定义包含表单的组件
    1. 界面如下所示
    2. 输入用户名密码后, 点击登陆提示输入信息
    3. 不提交表单
  */

  /* 
  2种带表单的组件
  1. 非受控组件: 只是在点击提交按钮才读取输入的数据
  2. 受控组件: 在输入过程中实时收集数据到state, 点击提交按钮只需要在state中读取即可
  */

  /* 非受控组件 */
  class Form extends React.Component {

    nameRef = React.createRef()
    pwdRef = React.createRef()

    login = (event) => {
      // 阻止事件的默认行为(提交表单)
      event.preventDefault()

      // 读取输入的数据
      const name = this.nameRef.current.value
      const pwd = this.pwdRef.current.value

      // 发登陆请求, 携带name和pwd
      alert(`提交登陆请求name=${name}, pwd=${pwd}`)
    }

    render () {
      return (
        <form action="/xxx" onSubmit={this.login}>
          用户名: <input type="text" ref={this.nameRef}/> &nbsp;
          密码: <input type="text" ref={this.pwdRef}/> &nbsp;
          <input type="submit" value="登陆" />
        </form>
      )
    }
  }

  /* 受控组件 */
  class Form2 extends React.Component {

    state = { // 初始化状态数据
      name: '',
      pwd: '',
      name2: '',
      pwd2: ''
    }

    login = (event) => {
      // 阻止事件的默认行为(提交表单)
      event.preventDefault()

      // 读取state中收集好的数据
      const {name, pwd, name2, pwd2} = this.state

      // 发登陆请求, 携带name和pwd
      alert(`提交登陆请求name=${name}, pwd=${pwd}, name2=${name2}, pwd2=${pwd2}`)
    }

    handleNameChange = (e) => {
      this.setState({
        name: e.target.value.trim()
      })
    }

    handlePwdChange = (e) => {
      this.setState({
        pwd: e.target.value.trim()
      })
    }

    handleChange = (propName, e) => {
      this.setState({
        [propName]: e.target.value.trim()
      })
    }

    handleChange2 = (propName) => {
      return e => {
        this.setState({
          [propName]: e.target.value.trim()
        })
      }
    }

    render () {
      const {name, pwd, name2, pwd2} = this.state
      return (
        <form action="/xxx" onSubmit={this.login}>
          {
            /* 
            用户名: <input type="text" value={name} onChange={this.handleNameChange}/> &nbsp;
            密码: <input type="text" value={pwd} onChange={this.handlePwdChange}/> &nbsp;
            */
          }
          用户名: <input type="text" value={name} onChange={(e) => this.handleChange('name', e)}/> &nbsp;
          密码: <input type="text" value={pwd} onChange={this.handleChange.bind(this, 'pwd')}/> &nbsp;

            用户名2: <input type="text" value={name2} onChange={this.handleChange2('name2')}/> &nbsp;
            密码2: <input type="text" value={pwd2} onChange={this.handleChange2('pwd2')}/> &nbsp;
          <input type="submit" value="登陆" />
        </form>


      )
    }
  }

  ReactDOM.render(<Form/>, document.getElementById('root'))
  ReactDOM.render(<Form2/>, document.getElementById('root2'))
</script>
</body>
</html>
